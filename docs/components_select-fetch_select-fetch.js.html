<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/select-fetch/select-fetch.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/select-fetch/select-fetch.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import Component from '../../class/Component';
import { Fetcher } from '../../class/Fetcher';

/**
 * Select element extended with fetch function
 * @module component/SelectFetch
 */

export class SelectFetch extends Component {
    /**
     * Initial parameters for SelectFetch
     * @typedef {Object} SelectFetchOption
     * @property {string} url
     * @property {HTMLObject} HTMLSpinner
     * @property {function} dataMap
     * @property {boolean} autoInit
     * @property {function} onChange
     */

    /**
     * Init component
     * @param {HTMLElement} HTMLElement - A DOM element pointing to a Select element
     * @param {...SelectFetchOption} [opt] - Component options {@link SelectFetchOption}
     */
    constructor( HTMLElement, opt ) {
        super();

        /**
         * @property {HTMLElement} HTMLComponent
         */
        this.HTMLComponent = HTMLElement;

        /**
         * @property {string} url
         */
        this.url = ( opt &amp;&amp; opt.url ) ? opt.url : '';

        /**
         * @property {HTMLElement} HTMLSpinner
         */
        this.HTMLSpinner = ( opt &amp;&amp; opt.HTMLSpinner ) ? opt.HTMLSpinner : null;

        /**
         * @property {function} dataMap
         */
        this.dataMap = ( opt &amp;&amp; opt.dataMap ) ? opt.dataMap : null;

        /**
         * @property {boolean} autoInit
         */
        this.autoInit = ( opt &amp;&amp; opt.autoInit ) ? opt.autoInit : false;

        /**
         * @property {function} onChange
         */
        this.onChange = ( opt &amp;&amp; opt.onChange ) ? opt.onChange : null;

        /**
         * @readonly
         * @property {HTMLElement} selectedItem
         */
        this.selectedItem = null;

        $( this.HTMLComponent ).
            on( 'change', ( e ) => {
                this.selectedItem = e.currentTarget;
                if ( this.onChange ) this.onChange( this.selectedItem );
            } );

        //

        this._fetcher = new Fetcher( this.url, { method: "GET" } );

        /**
         * @property {array} option
         */
        this.option = {};
        this.option[ 'emptyList' ] = this.findElement( { findIn: this.HTMLComponent, selector: 'option[data-type="emptyList"]' } )
        this.option[ 'prompt' ] = this.findElement( { findIn: this.HTMLComponent, selector: 'option[data-type="prompt"]' } )
        this.option[ 'default' ] = this.findElement( { findIn: this.HTMLComponent, selector: 'option[data-type="default"]' } )
        this.option[ 'error' ] = this.findElement( { findIn: this.HTMLComponent, selector: 'option[data-type="error"]' } )

        if ( this.autoInit )
            this.refresh();
    }

    /**
     * Refresh component
     */
    refresh () {

        // if spinner has declared, show it
        if ( this.HTMLSpinner ) $( this.HTMLSpinner ).show();

        this.HTMLComponent.empty();

        this._fetcher.getJSON()
            .then( ( data ) => {
                // if data object has error properity, throw error
                if ( data.error ) throw new Error( `Can't fetch data into select component` );

                if ( data.length == 0 ) {
                    // if data length is zero, put Empty list info to select list and exit;

                    this.HTMLComponent.append( this.option[ 'emptyList' ] );
                    return false;
                }

                // first in select list is Prompt
                this.HTMLComponent.append( this.option[ 'prompt' ] );

                // secound is Default options (if is exist)
                this.HTMLComponent.append( this.option[ 'default' ] );

                return data;
            } )

            // make options elements from data request
            .then( ( requestData ) => {
                // if no data, exit
                if ( !requestData ) return;

                // prepare data from nonconventional request
                let data;
                if ( this.dataMap )
                    data = this.dataMap( requestData );

                // entry: {Array} where
                // value {number} - value attribute of option element
                // name {string} - inner text of option element
                data.forEach( ( entry ) => {
                    let data = "";
                    if ( entry.data ) {
                        for ( let key in entry.data ) {
                            data += `data-${key}="${entry.data[ key ]}" `;
                        }
                    }
                    let item = $( `&lt;option class="item" ${data} value="${entry.value}">${entry.name}&lt;/option>` );
                    this.HTMLComponent.append( item );
                } );

            } )
            .catch( ( err ) => {
                console.error( err );
                this.HTMLComponent.append( this.option[ 'error' ] );
            } )
            .finally( () => {
                console.log( this.option );
                if ( this.option[ 'default' ] )
                    this.option[ 'default' ][ 0 ].selected = true
                else
                    if ( this.option[ 'prompt' ] )
                        this.option[ 'prompt' ][ 0 ].selected = true
                // if HTMLSpinner has declared, hide it
                if ( this.HTMLSpinner )
                    $( this.HTMLSpinner ).hide();
            } );
    }

    // TODO: Make method to select element by value
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-class_Fetcher.html">class/Fetcher</a></li><li><a href="module-class_Pages.html">class/Pages</a></li><li><a href="module-component_Dialog.html">component/Dialog</a></li><li><a href="module-Component_Paginator.html">Component/Paginator</a></li><li><a href="module-component_SelectFetch.html">component/SelectFetch</a></li><li><a href="module-misc.html">misc</a></li></ul><h3>Classes</h3><ul><li><a href="module-class_Fetcher.Fetcher.html">Fetcher</a></li><li><a href="module-class_Pages.Pages.html">Pages</a></li><li><a href="module-component_Dialog.Dialog.html">Dialog</a></li><li><a href="module-Component_Paginator.html">Component/Paginator</a></li><li><a href="module-component_SelectFetch.SelectFetch.html">SelectFetch</a></li></ul><h3>Global</h3><ul><li><a href="global.html#findElement">findElement</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Wed Oct 21 2020 09:03:20 GMT+0200 (czas Å›rodkowoeuropejski letni)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
